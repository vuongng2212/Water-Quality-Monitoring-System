{
  "info": {
    "_postman_id": "YOUR_POSTMAN_COLLECTION_ID",
    "name": "Water Quality Monitoring System API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "General Tests",
      "item": [
        {
          "name": "Login as adminA",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"adminA\",\n    \"password\": \"admin\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"adminToken\", jsonData.token);",
                  "pm.environment.set(\"adminAToken\", jsonData.token);",
                  "pm.test(\"Login successful\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.token).to.be.a('string');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Create a new device",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"name\": \"ESP32-Test-Device-{{$randomInt}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/devices",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"deviceId\", jsonData.id);",
                  "pm.environment.set(\"apiKey\", jsonData.apiKey);",
                  "pm.test(\"Device created successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.id).to.be.a('number');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Sending sensor data",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-API-KEY",
                "value": "{{apiKey}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"ph\": 7.5,\n    \"temperature\": 26.1,\n    \"turbidity\": 1.2,\n    \"tds\": 1.2\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/sensor-data",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "sensor-data"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Sensor data sent successfully\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Retrieving sensor data history",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/sensor-data/history/{{deviceId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "sensor-data",
                "history",
                "{{deviceId}}"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Sensor data history retrieved successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(pm.response.json()).to.be.an('array');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Fetching all users for the admin's factory",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Users retrieved successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(pm.response.json()).to.be.an('array');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Create a new employee user",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"employee_test_{{$randomInt}}\",\n    \"password\": \"employee_password\",\n    \"email\": \"employee_test_{{$randomInt}}@example.com\",\n    \"role\": \"EMPLOYEE\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"employeeId\", jsonData.id);",
                  "pm.test(\"Employee created successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.id).to.be.a('number');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Update the employee user",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"employee_test_updated_{{$randomInt}}\",\n    \"email\": \"employee_test_updated_{{$randomInt}}@example.com\",\n    \"role\": \"EMPLOYEE\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users/{{employeeId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users",
                "{{employeeId}}"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Employee updated successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(pm.response.json().id).to.eql(pm.environment.get(\"employeeId\"));",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Get the updated employee details",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/users/{{employeeId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users",
                "{{employeeId}}"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Employee details retrieved successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(pm.response.json().id).to.eql(pm.environment.get(\"employeeId\"));",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Delete the employee user",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/users/{{employeeId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users",
                "{{employeeId}}"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Employee deleted successfully\", function () {",
                  "    pm.response.to.have.status(204);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Fetching all devices for the admin's factory",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/devices",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Devices retrieved successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(pm.response.json()).to.be.an('array');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Update the device name",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"name\": \"ESP32-Test-Device-Updated-{{$randomInt}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/devices/{{deviceId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices",
                "{{deviceId}}"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Device updated successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(pm.response.json().name).to.include(\"ESP32-Test-Device-Updated\");",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Get the updated device details",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/devices/{{deviceId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices",
                "{{deviceId}}"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Device details retrieved successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(pm.response.json().id).to.eql(pm.environment.get(\"deviceId\"));",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Delete the device",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/devices/{{deviceId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices",
                "{{deviceId}}"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Device deleted successfully\", function () {",
                  "    pm.response.to.have.status(204);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Employee Permissions Tests",
      "item": [
        {
          "name": "Login as adminA (for employee permissions test)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"adminA\",\n    \"password\": \"admin\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"adminAToken\", jsonData.token);",
                  "pm.test(\"Login as adminA successful\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.token).to.be.a('string');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Create an employee user",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminAToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"employee_test_{{$randomInt}}\",\n    \"password\": \"password\",\n    \"email\": \"employee_test_{{$randomInt}}@factorya.com\",\n    \"role\": \"EMPLOYEE\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"employeeId\", jsonData.id);",
                  "pm.test(\"Employee created successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.id).to.be.a('number');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Create two devices",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminAToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"name\": \"DeviceA_Test_{{$randomInt}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/devices",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"deviceAId\", jsonData.id);",
                  "pm.environment.set(\"deviceAApiKey\", jsonData.apiKey);",
                  "pm.test(\"DeviceA created successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.id).to.be.a('number');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Create DeviceB",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminAToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"name\": \"DeviceB_Test_{{$randomInt}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/devices",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"deviceBId\", jsonData.id);",
                  "pm.environment.set(\"deviceBApiKey\", jsonData.apiKey);",
                  "pm.test(\"DeviceB created successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.id).to.be.a('number');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Login as employee",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"employee_test_{{$randomInt}}\",\n    \"password\": \"password\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"employeeToken\", jsonData.token);",
                  "pm.test(\"Login as employee successful\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.token).to.be.a('string');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Verify employee initially has no device access",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{employeeToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/devices",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Employee sees 0 devices initially\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(pm.response.json()).to.be.an('array').with.lengthOf(0);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Admin assigns DeviceA to employee",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminAToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"userId\": {{employeeId}}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/devices/{{deviceAId}}/assign",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices",
                "{{deviceAId}}",
                "assign"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"DeviceA assigned to employee successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Verify employee can now see only DeviceA",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{employeeToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/devices",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Employee sees only DeviceA\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(pm.response.json()).to.be.an('array').with.lengthOf(1);",
                  "    pm.expect(pm.response.json()[0].id).to.eql(pm.environment.get(\"deviceAId\"));",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Verify employee can access DeviceA details (succeed)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{employeeToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/devices/{{deviceAId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices",
                "{{deviceAId}}"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Employee can access DeviceA details\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(pm.response.json().id).to.eql(pm.environment.get(\"deviceAId\"));",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Verify employee cannot access DeviceB details (fail with 403)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{employeeToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/devices/{{deviceBId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices",
                "{{deviceBId}}"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Employee cannot access DeviceB details (403 Forbidden)\", function () {",
                  "    pm.response.to.have.status(403);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Send sensor data to DeviceA (succeed)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-API-KEY",
                "value": "{{deviceAApiKey}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"ph\": 7.0,\n    \"temperature\": 25.0,\n    \"turbidity\": 1.0,\n    \"tds\": 1.0\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/sensor-data",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "sensor-data"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Sensor data sent to DeviceA successfully\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Send sensor data to DeviceB (succeed)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "X-API-KEY",
                "value": "{{deviceBApiKey}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"ph\": 7.2,\n    \"temperature\": 26.0,\n    \"turbidity\": 1.2,\n    \"tds\": 1.2\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/sensor-data",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "sensor-data"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Sensor data sent to DeviceB successfully\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Verify employee can access DeviceA sensor data (succeed)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{employeeToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/sensor-data/history/{{deviceAId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "sensor-data",
                "history",
                "{{deviceAId}}"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Employee can access DeviceA sensor data\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(pm.response.json()).to.be.an('array');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Verify employee cannot access DeviceB sensor data (fail with 403)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{employeeToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/sensor-data/history/{{deviceBId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "sensor-data",
                "history",
                "{{deviceBId}}"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Employee cannot access DeviceB sensor data (403 Forbidden)\", function () {",
                  "    pm.response.to.have.status(403);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Admin unassigns DeviceA from employee",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminAToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"userId\": {{employeeId}}\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/devices/{{deviceAId}}/unassign",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices",
                "{{deviceAId}}",
                "unassign"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"DeviceA unassigned from employee successfully\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Verify employee can no longer access DeviceA (get devices)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{employeeToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/devices",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Employee sees 0 devices after unassignment\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(pm.response.json()).to.be.an('array').with.lengthOf(0);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Verify employee can no longer access DeviceA details (403)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{employeeToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/devices/{{deviceAId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices",
                "{{deviceAId}}"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Employee cannot access DeviceA details (403 Forbidden)\", function () {",
                  "    pm.response.to.have.status(403);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Verify employee can no longer access DeviceA sensor data (403)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{employeeToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/sensor-data/history/{{deviceAId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "sensor-data",
                "history",
                "{{deviceAId}}"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Employee cannot access DeviceA sensor data (403 Forbidden)\", function () {",
                  "    pm.response.to.have.status(403);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Admin tries to assign DeviceB to non-existent user (should fail)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminAToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"userId\": 99999\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/devices/{{deviceBId}}/assign",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices",
                "{{deviceBId}}",
                "assign"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Assign to non-existent user fails with 403\", function () {",
                  "    pm.response.to.have.status(403);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Admin tries to assign DeviceB to admin user (should fail)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminAToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"userId\": 1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/devices/{{deviceBId}}/assign",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices",
                "{{deviceBId}}",
                "assign"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"Assign to admin user fails with 403 or 500\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([403, 500]);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Multi-Tenancy Tests",
      "item": [
        {
          "name": "Login as adminA (for multi-tenancy test)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"adminA\",\n    \"password\": \"admin\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"adminAToken\", jsonData.token);",
                  "pm.test(\"Login as adminA successful\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.token).to.be.a('string');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "Login as adminB",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"adminB\",\n    \"password\": \"admin\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "login"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"adminBToken\", jsonData.token);",
                  "pm.test(\"Login as adminB successful\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.token).to.be.a('string');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "AdminA creates employeeA_test",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminAToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"employeeA_test\",\n    \"password\": \"employee\",\n    \"email\": \"employeeA_test@factorya.com\",\n    \"role\": \"EMPLOYEE\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"employeeAId\", jsonData.id);",
                  "pm.test(\"employeeA_test created successfully by adminA\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.id).to.be.a('number');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "AdminA creates deviceA_test",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminAToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"name\": \"deviceA_test\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/devices",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"deviceAId\", jsonData.id);",
                  "pm.test(\"deviceA_test created successfully by adminA\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.id).to.be.a('number');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "AdminB creates employeeB_test",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminBToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"username\": \"employeeB_test\",\n    \"password\": \"employee\",\n    \"email\": \"employeeB_test@factoryb.com\",\n    \"role\": \"EMPLOYEE\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"employeeBId\", jsonData.id);",
                  "pm.test(\"employeeB_test created successfully by adminB\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.id).to.be.a('number');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "AdminB creates deviceB_test",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminBToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"name\": \"deviceB_test\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/devices",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.environment.set(\"deviceBId\", jsonData.id);",
                  "pm.test(\"deviceB_test created successfully by adminB\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.id).to.be.a('number');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "AdminA fetching all users (should not see AdminB's user)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminAToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.test(\"AdminA does not see employeeB_test\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.some(user => user.id === pm.environment.get(\"employeeBId\"))).to.be.false;",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "AdminA fetching all devices (should not see AdminB's device)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminAToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/devices",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.test(\"AdminA does not see deviceB_test\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.some(device => device.id === pm.environment.get(\"deviceBId\"))).to.be.false;",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "AdminA attempting to fetch EmployeeB by ID (expecting 403)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminAToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/users/{{employeeBId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users",
                "{{employeeBId}}"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"AdminA cannot fetch employeeB_test by ID (403 Forbidden)\", function () {",
                  "    pm.response.to.have.status(403);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "AdminA attempting to fetch DeviceB by ID (expecting 403)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminAToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/devices/{{deviceBId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices",
                "{{deviceBId}}"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test(\"AdminA cannot fetch deviceB_test by ID (403 Forbidden)\", function () {",
                  "    pm.response.to.have.status(403);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "AdminB fetching all users (should not see AdminA's user)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminBToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/users",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "users"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.test(\"AdminB does not see employeeA_test\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.some(user => user.id === pm.environment.get(\"employeeAId\"))).to.be.false;",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "AdminB fetching all devices (should not see AdminA's device)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminBToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/devices",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "devices"
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "var jsonData = pm.response.json();",
                  "pm.test(\"AdminB does not see deviceA_test\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    pm.expect(jsonData.some(device => device.id === pm.environment.get(\"deviceAId\"))).to.be.false;",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          ""
        ]
      }
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080/api",
      "type": "string"
    },
    {
      "key": "adminToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "employeeToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "deviceId",
      "value": "",
      "type": "string"
    },
    {
      "key": "apiKey",
      "value": "",
      "type": "string"
    },
    {
      "key": "employeeId",
      "value": "",
      "type": "string"
    },
    {
      "key": "adminAToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "adminBToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "deviceAId",
      "value": "",
      "type": "string"
    },
    {
      "key": "deviceBId",
      "value": "",
      "type": "string"
    },
    {
      "key": "employeeAId",
      "value": "",
      "type": "string"
    },
    {
      "key": "employeeBId",
      "value": "",
      "type": "string"
    },
    {
      "key": "deviceAApiKey",
      "value": "",
      "type": "string"
    },
    {
      "key": "deviceBApiKey",
      "value": "",
      "type": "string"
    }
  ]
}